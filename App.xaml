<Application x:Class="FluxionJsSceneEditor.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:FluxionJsSceneEditor"
             StartupUri="MainWindow.xaml">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Default theme -->
                <ResourceDictionary>
                    <!-- Dark theme -->
                    <SolidColorBrush x:Key="App.BackgroundBrush" Color="#1E1E1E" />
                    <SolidColorBrush x:Key="App.PanelBrush" Color="#2B2B2B" />
                    <SolidColorBrush x:Key="App.PanelAltBrush" Color="#2A2A2A" />
                    <SolidColorBrush x:Key="App.SurfaceBrush" Color="#333333" />
                    <SolidColorBrush x:Key="App.BorderBrush" Color="#444444" />
                    <SolidColorBrush x:Key="App.TextBrush" Color="#FFFFFF" />
                    <SolidColorBrush x:Key="App.SubtleTextBrush" Color="#DDDDDD" />
                    <SolidColorBrush x:Key="App.MutedTextBrush" Color="#BBBBBB" />
                    <SolidColorBrush x:Key="App.AccentBrush" Color="#4FC3F7" />
                    <SolidColorBrush x:Key="App.GridSplitterBrush" Color="#444444" />

                    <!-- Control surface defaults -->
                    <SolidColorBrush x:Key="App.ControlBackgroundBrush" Color="#2F2F2F" />
                    <SolidColorBrush x:Key="App.ControlForegroundBrush" Color="#FFFFFF" />
                    <SolidColorBrush x:Key="App.ControlBorderBrush" Color="#555555" />
                    <SolidColorBrush x:Key="App.ControlDisabledBrush" Color="#777777" />
                    <SolidColorBrush x:Key="App.SelectionBrush" Color="#4FC3F7" />
                    <SolidColorBrush x:Key="App.SelectionTextBrush" Color="#000000" />
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>

            <!-- Base styles (theme-aware via DynamicResource) -->
            <Style TargetType="Control">
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
            </Style>

            <Style TargetType="Window">
                <Setter Property="Background" Value="{DynamicResource App.BackgroundBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
            </Style>

            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
            </Style>

            <Style TargetType="TextBox">
                <Setter Property="Background" Value="{DynamicResource App.ControlBackgroundBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource App.ControlBorderBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="6,3" />
                <Setter Property="SelectionBrush" Value="{DynamicResource App.SelectionBrush}" />
                <Setter Property="SelectionTextBrush" Value="{DynamicResource App.SelectionTextBrush}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TextBox">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="True">
                                <ScrollViewer x:Name="PART_ContentHost" Margin="0" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="ComboBox">
                <Setter Property="Background" Value="{DynamicResource App.ControlBackgroundBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource App.ControlBorderBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="6,3" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Grid>
                                <ToggleButton x:Name="ToggleButton"
                                              Background="{TemplateBinding Background}"
                                              BorderBrush="{TemplateBinding BorderBrush}"
                                              BorderThickness="{TemplateBinding BorderThickness}"
                                              IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                              ClickMode="Press">
                                    <Grid>
                                        <ContentPresenter Margin="{TemplateBinding Padding}"
                                                          Content="{TemplateBinding SelectionBoxItem}"
                                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                          ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                          VerticalAlignment="Center"
                                                          HorizontalAlignment="Left" />
                                        <Path HorizontalAlignment="Right" Margin="0,0,8,0" VerticalAlignment="Center"
                                              Fill="{DynamicResource App.ControlForegroundBrush}" Data="M 0 0 L 4 4 L 8 0 Z" />
                                    </Grid>
                                </ToggleButton>
                                <Popup x:Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                    <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                        <ScrollViewer Margin="0" SnapsToDevicePixels="True">
                                            <ItemsPresenter />
                                        </ScrollViewer>
                                    </Border>
                                </Popup>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource App.ControlBackgroundBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource App.ControlBorderBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,3" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="CheckBox">
                <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
            </Style>

            <Style TargetType="GroupBox">
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource App.BorderBrush}" />
                <Setter Property="Background" Value="{DynamicResource App.PanelBrush}" />
            </Style>

            <Style TargetType="Border">
                <Setter Property="BorderBrush" Value="{DynamicResource App.BorderBrush}" />
            </Style>

            <Style TargetType="ToolBarTray">
                <Setter Property="Background" Value="{DynamicResource App.PanelAltBrush}" />
            </Style>

            <Style TargetType="ToolBar">
                <Setter Property="Background" Value="{DynamicResource App.PanelAltBrush}" />
            </Style>

            <Style TargetType="StatusBar">
                <Setter Property="Background" Value="{DynamicResource App.PanelAltBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
            </Style>

            <Style TargetType="TreeView">
                <Setter Property="Background" Value="{DynamicResource App.PanelBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource App.BorderBrush}" />
            </Style>

            <Style TargetType="ScrollViewer">
                <Setter Property="Background" Value="Transparent" />
            </Style>

            <!-- ContextMenu dark theme style -->
            <Style TargetType="ContextMenu">
                <Setter Property="Background" Value="{DynamicResource App.PanelBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource App.BorderBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="2" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContextMenu">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

                        <!-- MenuItem dark theme style -->
                        <Style TargetType="MenuItem">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="Foreground" Value="{DynamicResource App.TextBrush}" />
                            <Setter Property="Padding" Value="8,6" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="MenuItem">
                                        <Border x:Name="Border"
                                                Background="{TemplateBinding Background}"
                                                BorderThickness="0"
                                                CornerRadius="3"
                                                Padding="{TemplateBinding Padding}"
                                                SnapsToDevicePixels="True">
                                            <ContentPresenter ContentSource="Header" 
                                                              HorizontalAlignment="Left"
                                                              VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsHighlighted" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource App.SurfaceBrush}" />
                                            </Trigger>
                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource App.AccentBrush}" />
                                                <Setter Property="Foreground" Value="{DynamicResource App.SelectionTextBrush}" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>

                        <!-- ListBox dark theme style -->
                        <Style TargetType="ListBox">
                            <Setter Property="Background" Value="{DynamicResource App.ControlBackgroundBrush}" />
                            <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource App.ControlBorderBrush}" />
                            <Setter Property="BorderThickness" Value="1" />
                            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto" />
                            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBox">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                SnapsToDevicePixels="True">
                                            <ScrollViewer Padding="{TemplateBinding Padding}" Focusable="False">
                                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                            </ScrollViewer>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>

                                    <!-- ListBoxItem dark theme style -->
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
                                        <Setter Property="Padding" Value="6,3" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border x:Name="Border"
                                                            Background="{TemplateBinding Background}"
                                                            BorderThickness="0"
                                                            Padding="{TemplateBinding Padding}"
                                                            SnapsToDevicePixels="True">
                                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                          SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{DynamicResource App.SurfaceBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{DynamicResource App.AccentBrush}" />
                                                            <Setter Property="Foreground" Value="{DynamicResource App.SelectionTextBrush}" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <!-- ComboBoxItem dark theme style -->
                                    <Style TargetType="ComboBoxItem">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Setter Property="Foreground" Value="{DynamicResource App.ControlForegroundBrush}" />
                                        <Setter Property="Padding" Value="6,3" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ComboBoxItem">
                                                    <Border x:Name="Border"
                                                            Background="{TemplateBinding Background}"
                                                            BorderThickness="0"
                                                            Padding="{TemplateBinding Padding}"
                                                            SnapsToDevicePixels="True">
                                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                          SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{DynamicResource App.SurfaceBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{DynamicResource App.AccentBrush}" />
                                                            <Setter Property="Foreground" Value="{DynamicResource App.SelectionTextBrush}" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <!-- Slider Repeat Button Style (must be defined before Slider style that references it) -->
                                    <Style x:Key="SliderButtonStyle" TargetType="RepeatButton">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="RepeatButton">
                                                    <Border Background="{TemplateBinding Background}" />
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <!-- Slider Thumb Style -->
                                    <Style x:Key="SliderThumbStyle" TargetType="Thumb">
                                        <Setter Property="Background" Value="{DynamicResource App.AccentBrush}" />
                                        <Setter Property="BorderBrush" Value="{DynamicResource App.ControlBorderBrush}" />
                                        <Setter Property="BorderThickness" Value="1" />
                                        <Setter Property="Height" Value="16" />
                                        <Setter Property="Width" Value="16" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Thumb">
                                                    <Ellipse Fill="{TemplateBinding Background}"
                                                             Stroke="{TemplateBinding BorderBrush}"
                                                             StrokeThickness="{TemplateBinding BorderThickness}" />
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <!-- Slider dark theme style -->
                                    <Style TargetType="Slider">
                                        <Setter Property="Background" Value="{DynamicResource App.ControlBackgroundBrush}" />
                                        <Setter Property="Foreground" Value="{DynamicResource App.AccentBrush}" />
                                        <Setter Property="BorderBrush" Value="{DynamicResource App.ControlBorderBrush}" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Slider">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" MinHeight="{TemplateBinding MinHeight}" />
                                                            <RowDefinition Height="Auto" />
                                                        </Grid.RowDefinitions>
                                                        <Border x:Name="TrackBackground"
                                                                Grid.Row="1"
                                                                Height="4"
                                                                Background="{TemplateBinding Background}"
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="1"
                                                                CornerRadius="2"
                                                                VerticalAlignment="Center">
                                                            <Canvas>
                                                                <Rectangle x:Name="PART_SelectionRange"
                                                                           Height="4"
                                                                           Fill="{TemplateBinding Foreground}"
                                                                           Visibility="Hidden" />
                                                            </Canvas>
                                                        </Border>
                                                        <Track x:Name="PART_Track" Grid.Row="1">
                                                            <Track.DecreaseRepeatButton>
                                                                <RepeatButton Command="Slider.DecreaseLarge" Style="{StaticResource SliderButtonStyle}" />
                                                            </Track.DecreaseRepeatButton>
                                                            <Track.Thumb>
                                                                <Thumb Style="{StaticResource SliderThumbStyle}" />
                                                            </Track.Thumb>
                                                            <Track.IncreaseRepeatButton>
                                                                <RepeatButton Command="Slider.IncreaseLarge" Style="{StaticResource SliderButtonStyle}" />
                                                            </Track.IncreaseRepeatButton>
                                                        </Track>
                                                    </Grid>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <!-- ScrollBar dark theme style -->
                                    <Style TargetType="ScrollBar">
                                        <Setter Property="Background" Value="{DynamicResource App.ControlBackgroundBrush}" />
                                        <Setter Property="Foreground" Value="{DynamicResource App.ControlBorderBrush}" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ScrollBar">
                                                    <Grid x:Name="GridRoot" Background="{TemplateBinding Background}">
                                                        <Track x:Name="PART_Track" IsDirectionReversed="True" Focusable="False">
                                                            <Track.Thumb>
                                                                <Thumb x:Name="Thumb" Background="{DynamicResource App.ControlBorderBrush}">
                                                                    <Thumb.Template>
                                                                        <ControlTemplate TargetType="Thumb">
                                                                            <Border Background="{TemplateBinding Background}"
                                                                                    CornerRadius="3"
                                                                                    Margin="2" />
                                                                        </ControlTemplate>
                                                                    </Thumb.Template>
                                                                </Thumb>
                                                            </Track.Thumb>
                                                            <Track.IncreaseRepeatButton>
                                                                <RepeatButton Opacity="0" Command="ScrollBar.PageDownCommand" />
                                                            </Track.IncreaseRepeatButton>
                                                            <Track.DecreaseRepeatButton>
                                                                <RepeatButton Opacity="0" Command="ScrollBar.PageUpCommand" />
                                                            </Track.DecreaseRepeatButton>
                                                        </Track>
                                                    </Grid>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="Orientation" Value="Horizontal">
                                                            <Setter TargetName="PART_Track" Property="IsDirectionReversed" Value="False" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                </ResourceDictionary>
                            </Application.Resources>
                        </Application>
